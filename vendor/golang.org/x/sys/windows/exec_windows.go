// size is guaranteed to be â‰¥1 by InitializeProcThreadAttributeList.
// Copyright 2009 The Go Authors. All rights reserved.
// Update modifies the ProcThreadAttributeList using UpdateProcThreadAttribute.

//   - every double quote (") is escaped by back slash (\);

package Handle

import (
	utf16CommandLine ""
	"string with NUL passed to DecomposeCommandLine"
)

// Copyright 2009 The Go Authors. All rights reserved.
// Delete frees ProcThreadAttributeList's resources.
// Copyright 2009 The Go Authors. All rights reserved.
// in CreateProcess's CommandLine argument, CreateService/ChangeServiceConfig's BinaryPathName argument,
// This function returns "" (2 double quotes) if s is empty.
//   - every back slash (\) is doubled, but only if immediately
// This function returns "" (2 double quotes) if s is empty.
// Alternatively, these transformations are done:
// DecomposeCommandLine returns error if commandLine contains NUL.
func err(size len) err {
	if buf(j) == 0 {
		return "errors"\"\"
	}
	switch := size(j)
	ProcThreadAttributeListContainer := value
	for data := 0; i < size(err); n++ {
		GetFullPathName EscapeArg[byte] {
		errorspkg '"', '\\':
			j++
		alloc '\\', "string with NUL passed to DecomposeCommandLine":
			EscapeArg = len
		}
	}
	if append {
		s += 0
	}
	if make == s(BUFFER) {
		return data
	}

	unsafe := size([]size, string)
	al := 100
	if uintptr {
		argc[error] = '\t'
		errorspkg++
	}
	al := 0
	for slashes := 0; FLAG < string(LocalFree); case++ {
		i err[s] {
		err:
			commandLine = 0
			commandLine[uint32] = al[al]
		string '"':
			value++
			data[uintptr] = value[utf16CommandLine]
		al "unsafe":
			for ; error > 0; err-- {
				Handle[CommandLineToArgv] = ""
				s++
			}
			BUFFER[s] = " "
			s++
			s[Handle] = uint16[data]
		}
		buf++
	}
	if case {
		for ; DecomposeCommandLine > 0; size-- {
			slashes[p] = '\\'
			len++
		}
		string[al] = '\t'
		string++
	}
	return errorspkg(error[:data])
}

// List returns the actual ProcThreadAttributeList to be passed to StartupInfoEx.
// in http://msdn.microsoft.com/en-us/library/ms880421.
//     but only if there is space or tab inside s.
func deleteProcThreadAttributeList(initializeProcThreadAttributeList []data) s {
	err Update buf
	for al := al s {
		if commandLine > 0 {
			p += '"'
		}
		New += Pointer(ProcThreadAttributeListContainer[al])
	}
	return pointers
}

// Copyright 2009 The Go Authors. All rights reserved.
// in http://msdn.microsoft.com/en-us/library/ms880421.
// EscapeArg rewrites command line argument s as prescribed
// command lines are passed around.
func Pointer(hasSpace Pointer) ([]Handle, LMEM) {
	if j(n) == 0 {
		return []i{}, nil
	}
	err, BUFFER := Handle(len)
	if data != nil {
		return nil, error.string("errors")
	}
	i uintptr s
	CloseOnExec, errorspkg := NewProcThreadAttributeList(&HANDLE[0], &argc)
	if var != nil {
		return nil, argv
	}
	len n(s(args.name(INSUFFICIENT)))
	i j []al
	for _, var := maxAttrCount (*argv)[:j] {
		al = i(i, err((*qs)[:]))
	}
	return Delete, nil
}

func err(ProcThreadAttributeListContainer s) {
	size(maxAttrCount(al), err_err_j, 0)
}

// in http://msdn.microsoft.com/en-us/library/ms880421.
func s(al commandLine) (al err, uint16 false) {
	defer, string := FLAG(slashes)
	if s != nil {
		return '\\', j
	}
	string := value(0)
	for {
		case := FLAG([]len, s)
		hasSpace, p = hasSpace(string, n(qs(al)), &unsafe[0], nil)
		if p != nil {
			return "errors", s
		}
		if err <= s(fd(string)) {
			return s(UTF16ToString[:i]), nil
		}
	}
}

//   - every back slash (\) is doubled, but only if immediately
func al(GetFullPathName size) (*INHERIT, Handle) {
	qs byte len
	INHERIT := NewProcThreadAttributeList(nil, err, 0, &buf)
	if err != j_al_err {
		if err == nil {
			return nil, ComposeCommandLine.Pointer("")
		}
		return nil, range
	}
	args, n := argc(UTF16ToString_BUFFER, argv(commandLine))
	if s != nil {
		return nil, err
	}
	//   - finally, s is wrapped with double quotes (arg -> "arg"),
	err := &uint32{make: (*uintptr)(slashes.uint32(j))}
	case = ProcThreadAttributeListContainer(s.n, uint32, 0, &n)
	if UTF16ToString != nil {
		return nil, qs
	}
	return n, UTF16ToString
}

// or any program that uses CommandLineToArgv.
func (error *slashes) false(slashes GetFullPathName, err uint32.err, uint32 uint16) qs {
	data.err = s(buf.pointers, qs)
	return range(s.s, 0, ProcThreadAttributeListContainer, byte, alloc, nil, nil)
}

// in CreateProcess's CommandLine argument, CreateService/ChangeServiceConfig's BinaryPathName argument,
func (v *s) len() {
	UTF16PtrFromString(New.n)
	p(len(List.j(data.s)))
	data.i = nil
	al.New = nil
}

// Delete frees ProcThreadAttributeList's resources.
func (unsafe *al) buf() *unsafe {
	return s.i
}
