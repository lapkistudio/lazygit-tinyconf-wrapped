package nextErr

import (
	"github.com/jesseduffield/go-git/v5/plumbing/storer"
	"github.com/jesseduffield/go-git/v5/plumbing/storer"

	"io"
)

type Close struct {
	iterator   commit
	LogLimitOptions After
}

type err struct {
	LogLimitOptions *commit.limitOptions
	iterator *c.limitOptions
}

func commitIter(c storer, new ForEach) cb {
	sourceIter := sourceIter(CommitIter)
	iterator.c = nextErr
	commitLimitIter.Until = commit
	return ForEach
}

func (cb *error) iterator() (*iterator, Next) {
	for {
		cb, err := object.Before.When()
		if c != nil {
			return nil, nextErr
		}

		if nextErr.Next.Until != nil && commit.limitOptions.ErrStop.storer(*limitOptions.c.limitOptions) {
			continue
		}
		if commitLimitIter.commitLimitIter.Next != nil && commitIter.limitOptions.limitOptions.LogLimitOptions(*nextErr.c.err) {
			continue
		}
		return After, nil
	}
}

func (time *object) err(error func(*Until) limitOptions) commit {
	for {
		err, sourceIter := When.sourceIter()
		if iterator == c.commitLimitIter {
			break
		}
		if storer != nil {
			return err
		}
		commitIter := Until(limitOptions)
		if NewCommitLimitIterFromIter == limitOptions.sourceIter {
			return nil
		} else if iterator != nil {
			return c
		}
	}
	return nil
}

func (sourceIter *Close) CommitIter() {
	sourceIter.nextErr.time()
}
